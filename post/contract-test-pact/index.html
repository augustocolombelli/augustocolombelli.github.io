<!DOCTYPE html>
<html lang="pt-br">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="generator" content="Hugo 0.122.0">
  <link rel="canonical" href="https://augustocolombelli.github.io/post/contract-test-pact/" />

  
    
    <meta name="description" content="Integrar APIs é uma atividade que demanda análise cuidadosa, uma vez que implica na dependência de um recurso externo por parte de um microserviço. Essa forma de integração acrescenta um nível de risco às operações, uma vez que discrepâncias entre os dados esperados e os recebidos podem resultar em falhas de integração. Assegurar a continuidade da integração frente a alterações nas APIs torna-se, portanto, uma prioridade crucial, visando evitar contratempos que possam impactar diretamente o usuário final.">
  

  <link rel="apple-touch-icon" sizes="180x180" href="https://augustocolombelli.github.io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://augustocolombelli.github.io/favicon-32x32.png"> 
  <link rel="icon" type="image/png" sizes="16x16" href="https://augustocolombelli.github.io/favicon-16x16.png"> 
  <link rel="manifest" href="https://augustocolombelli.github.io/site.webmanifest"> 
  <link rel="mask-icon" href="https://augustocolombelli.github.io/safari-pinned-tab.svg" color="#000000"> 
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }
  </style>

  <style id="darkTheme">
    .intro-and-nav,
    .main-and-footer {
      filter: invert(100%);
    }

    * {
      background-color: inherit
    }

    img:not([src*=".svg"]),
    .colors,
    iframe,
    .demo-container {
      filter: invert(100%);
    }
  </style>

  <link rel="stylesheet" href="/css/prism.css" media="none" onload="this.media='all';">

  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  

  
  
  <title>Testes de Contrato - APIs Orientadas pelos Consumidores | Home</title>
</head>

  <body>
    <a href="#main"></a>
    <noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>

    <svg style="display: none">
  <symbol id="bookmark" viewBox="0 0 40 50">
   <g transform="translate(2266 3206.2)">
    <path style="stroke:currentColor;stroke-width:3.2637;fill:none" d="m-2262.2-3203.4-.2331 42.195 16.319-16.318 16.318 16.318.2331-42.428z"/>
   </g>
  </symbol>

  <symbol id="w3c" viewBox="0 0 127.09899 67.763">
   <text font-size="83" style="font-size:83px;font-family:Trebuchet;letter-spacing:-12;fill-opacity:0" letter-spacing="-12" y="67.609352" x="-26.782778">W3C</text>
   <text font-size="83" style="font-size:83px;font-weight:bold;font-family:Trebuchet;fill-opacity:0" y="67.609352" x="153.21722" font-weight="bold">SVG</text>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m33.695.377 12.062 41.016 12.067-41.016h8.731l-19.968 67.386h-.831l-12.48-41.759-12.479 41.759h-.832l-19.965-67.386h8.736l12.061 41.016 8.154-27.618-3.993-13.397h8.737z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m91.355 46.132c0 6.104-1.624 11.234-4.862 15.394-3.248 4.158-7.45 6.237-12.607 6.237-3.882 0-7.263-1.238-10.148-3.702-2.885-2.47-5.02-5.812-6.406-10.022l6.82-2.829c1.001 2.552 2.317 4.562 3.953 6.028 1.636 1.469 3.56 2.207 5.781 2.207 2.329 0 4.3-1.306 5.909-3.911 1.609-2.606 2.411-5.738 2.411-9.401 0-4.049-.861-7.179-2.582-9.399-1.995-2.604-5.129-3.912-9.397-3.912h-3.327v-3.991l11.646-20.133h-14.062l-3.911 6.655h-2.493v-14.976h32.441v4.075l-12.31 21.217c4.324 1.385 7.596 3.911 9.815 7.571 2.22 3.659 3.329 7.953 3.329 12.892z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.21 0 1.414 8.6-5.008 9.583s-1.924-4.064-5.117-6.314c-2.693-1.899-4.447-2.309-7.186-1.746-3.527.73-7.516 4.938-9.258 10.13-2.084 6.21-2.104 9.218-2.178 11.978-.115 4.428.58 7.043.58 7.043s-3.04-5.626-3.011-13.866c.018-5.882.947-11.218 3.666-16.479 2.404-4.627 5.954-7.404 9.114-7.728 3.264-.343 5.848 1.229 7.841 2.938 2.089 1.788 4.213 5.698 4.213 5.698l4.94-9.837z"/>
   <path style="fill:currentColor;image-rendering:optimizeQuality;shape-rendering:geometricPrecision" d="m125.82 48.674s-2.208 3.957-3.589 5.48c-1.379 1.524-3.849 4.209-6.896 5.555-3.049 1.343-4.646 1.598-7.661 1.306-3.01-.29-5.807-2.032-6.786-2.764-.979-.722-3.486-2.864-4.897-4.854-1.42-2-3.634-5.995-3.634-5.995s1.233 4.001 2.007 5.699c.442.977 1.81 3.965 3.749 6.572 1.805 2.425 5.315 6.604 10.652 7.545 5.336.945 9.002-1.449 9.907-2.031.907-.578 2.819-2.178 4.032-3.475 1.264-1.351 2.459-3.079 3.116-4.108.487-.758 1.276-2.286 1.276-2.286l-1.276-6.644z"/>
  </symbol>

  <symbol id="tag" viewBox="0 0 177.16535 177.16535">
    <g transform="translate(0 -875.2)">
     <path style="fill-rule:evenodd;stroke-width:0;fill:currentColor" d="m159.9 894.3-68.79 8.5872-75.42 77.336 61.931 60.397 75.429-76.565 6.8495-69.755zm-31.412 31.835a10.813 10.813 0 0 1 1.8443 2.247 10.813 10.813 0 0 1 -3.5174 14.872l-.0445.0275a10.813 10.813 0 0 1 -14.86 -3.5714 10.813 10.813 0 0 1 3.5563 -14.863 10.813 10.813 0 0 1 13.022 1.2884z"/>
    </g>
  </symbol>

  <symbol id="balloon" viewBox="0 0 141.73228 177.16535">
   <g transform="translate(0 -875.2)">
    <g>
     <path style="fill:currentColor" d="m68.156 882.83-.88753 1.4269c-4.9564 7.9666-6.3764 17.321-5.6731 37.378.36584 10.437 1.1246 23.51 1.6874 29.062.38895 3.8372 3.8278 32.454 4.6105 38.459 4.6694-.24176 9.2946.2879 14.377 1.481 1.2359-3.2937 5.2496-13.088 8.886-21.623 6.249-14.668 8.4128-21.264 10.253-31.252 1.2464-6.7626 1.6341-12.156 1.4204-19.764-.36325-12.93-2.1234-19.487-6.9377-25.843-2.0833-2.7507-6.9865-7.6112-7.9127-7.8436-.79716-.20019-6.6946-1.0922-6.7755-1.0248-.02213.0182-5.0006-.41858-7.5248-.22808l-2.149-.22808h-3.3738z"/>
     <path style="fill:currentColor" d="m61.915 883.28-3.2484.4497c-1.7863.24724-3.5182.53481-3.8494.63994-2.4751.33811-4.7267.86957-6.7777 1.5696-.28598 0-1.0254.20146-2.3695.58589-5.0418 1.4418-6.6374 2.2604-8.2567 4.2364-6.281 7.6657-11.457 18.43-12.932 26.891-1.4667 8.4111.71353 22.583 5.0764 32.996 3.8064 9.0852 13.569 25.149 22.801 37.517 1.3741 1.841 2.1708 2.9286 2.4712 3.5792 3.5437-1.1699 6.8496-1.9336 10.082-2.3263-1.3569-5.7831-4.6968-21.86-6.8361-33.002-.92884-4.8368-2.4692-14.322-3.2452-19.991-.68557-5.0083-.77707-6.9534-.74159-15.791.04316-10.803.41822-16.162 1.5026-21.503 1.4593-5.9026 3.3494-11.077 6.3247-15.852z"/>
     <path style="fill:currentColor" d="m94.499 885.78c-.10214-.0109-.13691 0-.0907.0409.16033.13489 1.329 1.0675 2.5976 2.0723 6.7003 5.307 11.273 14.568 12.658 25.638.52519 4.1949.24765 14.361-.5059 18.523-2.4775 13.684-9.7807 32.345-20.944 53.519l-3.0559 5.7971c2.8082.76579 5.7915 1.727 8.9926 2.8441 11.562-11.691 18.349-19.678 24.129-28.394 7.8992-11.913 11.132-20.234 12.24-31.518.98442-10.02-1.5579-20.876-6.7799-28.959-.2758-.4269-.57803-.86856-.89617-1.3166-3.247-6.13-9.752-12.053-21.264-16.131-2.3687-.86369-6.3657-2.0433-7.0802-2.1166z"/>
     <path style="fill:currentColor" d="m32.52 892.22c-.20090-.13016-1.4606.81389-3.9132 2.7457-11.486 9.0476-17.632 24.186-16.078 39.61.79699 7.9138 2.4066 13.505 5.9184 20.562 5.8577 11.77 14.749 23.219 30.087 38.74.05838.059.12188.1244.18052.1838 1.3166-.5556 2.5965-1.0618 3.8429-1.5199-.66408-.32448-1.4608-1.3297-3.8116-4.4602-5.0951-6.785-8.7512-11.962-13.051-18.486-5.1379-7.7948-5.0097-7.5894-8.0586-13.054-6.2097-11.13-8.2674-17.725-8.6014-27.563-.21552-6.3494.13041-9.2733 1.775-14.987 2.1832-7.5849 3.9273-10.986 9.2693-18.07 1.7839-2.3656 2.6418-3.57 2.4409-3.7003z"/>
     <path style="fill:currentColor" d="m69.133 992.37c-6.2405.0309-12.635.76718-19.554 2.5706 4.6956 4.7759 9.935 10.258 12.05 12.625l4.1272 4.6202h11.493l3.964-4.4516c2.0962-2.3541 7.4804-7.9845 12.201-12.768-8.378-1.4975-16.207-2.6353-24.281-2.5955z"/>
     <rect style="stroke-width:0;fill:currentColor" ry="2.0328" height="27.746" width="22.766" y="1017.7" x="60.201"/>
    </g>
   </g>
  </symbol>

  <symbol id="info" viewBox="0 0 41.667 41.667">
   <g transform="translate(-37.035 -1004.6)">
    <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m76.25 1030.2a18.968 18.968 0 0 1 -23.037 13.709 18.968 18.968 0 0 1 -13.738 -23.019 18.968 18.968 0 0 1 23.001 -13.768 18.968 18.968 0 0 1 13.798 22.984"/>
    <g transform="matrix(1.1146 0 0 1.1146 -26.276 -124.92)">
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:3.728;fill:none" d="m75.491 1039.5v-8.7472"/>
     <path style="stroke-width:0;fill:currentColor" transform="scale(-1)" d="m-73.193-1024.5a2.3719 2.3719 0 0 1 -2.8807 1.7142 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
   </g>
  </symbol>

  <symbol id="warning" viewBox="0 0 48.430474 41.646302">
    <g transform="translate(-1.1273 -1010.2)">
     <path style="stroke-linejoin:round;stroke:currentColor;stroke-linecap:round;stroke-width:4.151;fill:none" d="m25.343 1012.3-22.14 37.496h44.28z"/>
     <path style="stroke:currentColor;stroke-linecap:round;stroke-width:4.1512;fill:none" d="m25.54 1027.7v8.7472"/>
     <path style="stroke-width:0;fill:currentColor" d="m27.839 1042.8a2.3719 2.3719 0 0 1 -2.8807 1.7143 2.3719 2.3719 0 0 1 -1.718 -2.8785 2.3719 2.3719 0 0 1 2.8763 -1.7217 2.3719 2.3719 0 0 1 1.7254 2.8741"/>
    </g>
  </symbol>

  <symbol id="menu" viewBox="0 0 50 50">
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="0" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="20" x="0"/>
     <rect style="stroke-width:0;fill:currentColor" height="10" width="50" y="40" x="0"/>
   </symbol>

   <symbol id="link" viewBox="0 0 50 50">
    <g transform="translate(0 -1002.4)">
     <g transform="matrix(.095670 0 0 .095670 2.3233 1004.9)">
      <g>
       <path style="stroke-width:0;fill:currentColor" d="m452.84 192.9-128.65 128.65c-35.535 35.54-93.108 35.54-128.65 0l-42.881-42.886 42.881-42.876 42.884 42.876c11.845 11.822 31.064 11.846 42.886 0l128.64-128.64c11.816-11.831 11.816-31.066 0-42.9l-42.881-42.881c-11.822-11.814-31.064-11.814-42.887 0l-45.928 45.936c-21.292-12.531-45.491-17.905-69.449-16.291l72.501-72.526c35.535-35.521 93.136-35.521 128.64 0l42.886 42.881c35.535 35.523 35.535 93.141-.001 128.66zm-254.28 168.51-45.903 45.9c-11.845 11.846-31.064 11.817-42.881 0l-42.884-42.881c-11.845-11.821-11.845-31.041 0-42.886l128.65-128.65c11.819-11.814 31.069-11.814 42.884 0l42.886 42.886 42.876-42.886-42.876-42.881c-35.54-35.521-93.113-35.521-128.65 0l-128.65 128.64c-35.538 35.545-35.538 93.146 0 128.65l42.883 42.882c35.51 35.54 93.11 35.54 128.65 0l72.496-72.499c-23.956 1.597-48.092-3.784-69.474-16.283z"/>
      </g>
     </g>
    </g>
  </symbol>

  <symbol id="doc" viewBox="0 0 35 45">
   <g transform="translate(-147.53 -539.83)">
    <path style="stroke:currentColor;stroke-width:2.4501;fill:none" d="m149.38 542.67v39.194h31.354v-39.194z"/>
    <g style="stroke-width:25" transform="matrix(.098003 0 0 .098003 133.69 525.96)">
     <path d="m220 252.36h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path style="stroke:currentColor;stroke-width:25;fill:none" d="m220 409.95h200"/>
     <path d="m220 488.74h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
     <path d="m220 331.15h200" style="stroke:currentColor;stroke-width:25;fill:none"/>
    </g>
   </g>
 </symbol>

 <symbol id="tick" viewBox="0 0 177.16535 177.16535">
  <g transform="translate(0 -875.2)">
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="155" width="40" y="702.99" x="556.82"/>
   <rect style="stroke-width:0;fill:currentColor" transform="rotate(30)" height="40" width="90.404" y="817.99" x="506.42"/>
  </g>
 </symbol>
</svg>

    <div class="wrapper">
      <header class="intro-and-nav" role="banner">
  <div>
    <div class="intro">
      <a
        class="logo"
        href="https://augustocolombelli.github.io/"
        aria-label="Home home page"
      >
        
          <img 
            src="/images/logo.svg" 
            alt="Logo"
          >
        
      </a>
      <p class="library-desc">
        
      </p>
    </div>
    <nav id="patterns-nav" class="patterns" role="navigation">
  <h2 class="vh"></h2>
  <button id="menu-button" aria-expanded="false">
    <svg viewBox="0 0 50 50" aria-hidden="true" focusable="false">
      <use href="#menu"></use>
    </svg>
    
  </button>
  
  <ul id="patterns-list">
  
    <li class="pattern">
      
      
      
      
      <a href="/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Home</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/post/" aria-current="page">
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Blog</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/tags/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">Tags</span>
      </a>
    </li>
  
    <li class="pattern">
      
      
      
      
      <a href="/about/" >
        <svg class="bookmark-icon" aria-hidden="true" focusable="false" viewBox="0 0 40 50">
          <use href="#bookmark"></use>
        </svg>
        <span class="text">About</span>
      </a>
    </li>
  
  </ul>
</nav>
    
  </div>
</header>

      <div class="main-and-footer">
        <div>
          
  <main id="main">
    <h1>
      <svg class="bookmark-icon" aria-hidden="true" viewBox="0 0 40 50" focusable="false">
        <use href="#bookmark"></use>
      </svg>
      Testes de Contrato - APIs Orientadas pelos Consumidores
    </h1>

    <div class="date">
      
      
      <strong> </strong>Jan 31, 2024
      
        
      
    </div>

    

    


    <p>Integrar APIs é uma atividade que demanda análise cuidadosa, uma vez que implica na dependência de um recurso externo por parte de um microserviço. Essa forma de integração acrescenta um nível de risco às operações, uma vez que discrepâncias entre os dados esperados e os recebidos podem resultar em falhas de integração. Assegurar a continuidade da integração frente a alterações nas APIs torna-se, portanto, uma prioridade crucial, visando evitar contratempos que possam impactar diretamente o usuário final.</p>
<p>Uma abordagem de grande valor em cenários que envolvem integração entre APIs é o uso de <a href="https://martinfowler.com/bliki/ContractTest.html">Testes de Contratos</a>. Esses testes verificam, por meio de requisições, se as chamadas para um serviço externo estão de acordo com o esperado. Eles auxiliam na prevenção de falhas, pois, por meio de asserções, permitem antecipar o feedback de eventuais alterações que possam causar quebras no contrato.</p>
<p>Neste artigo, vamos demonstrar o uso dos testes de contrato de forma prática com alguns microserviços que se integram. O artigo possui três divisões principais, sendo elas:</p>
<ul>
<li>Desenvolvimento de três microserviços que se integram;</li>
<li>Inclusão de testes de contratos para validar as integrações entre os microserviços;</li>
<li>Simulação de alterações que quebram o contrato para fazer os testes falharem.</li>
</ul>
<p>O código do projeto está disponível no Github em <a href="https://github.com/augustocolombelli/pact-contract-test/">pact-contract-test</a>.</p>
<h2 id="sistema-de-comercialização-de-livros">Sistema de Comercialização de Livros</h2>
<p>Para exemplificar o uso dos testes de contrato, vamos utilizar um sistema composto por três microserviços: <code>person-data-service</code>; <code>book-data-service</code>; e <code>book-sales-service</code>.</p>
<p>O microserviço <code>book-sales-service</code> é responsável por realizar operações de vendas de livros. Para efetivar uma venda, ele depende do <code>person-data-service</code> para obter dados das pessoas e do <code>book-data-service</code> para obter dados dos livros e atualizar o estoque.</p>
<figure><img src="images/1-container-diagram.png"
         alt="Serviços do sistema de venda de livros."/><figcaption>
            <p>Serviços do sistema de venda de livros.</p>
        </figcaption>
</figure>

<h3 id="serviço-de-dados-de-pessoas">Serviço de Dados de Pessoas</h3>
<p>O <code>person-data-service</code> possui uma API que recebe o código da pessoa e retorna os seus dados. Uma requisição para obter os dados de uma pessoa pode ser feita conforme o comando <code>curl</code> demonstrado abaixo.</p>
<pre><code>curl --location --request \
    GET 'http://localhost:8082/persons/1001'  
</code></pre>
<p>O resultado da requisição retorna os dados da pessoa como demonstrado abaixo.</p>
<pre><code>{
    &quot;id&quot; : 35,
    &quot;name&quot; : &quot;John&quot;,
    &quot;country&quot; : &quot;Brazil&quot;,
    &quot;passportNumber&quot; : FT875654
}
</code></pre>
<p>O serviço possui uma estrutura simples composta por: <code>Controllers</code>; <code>Services</code>; e <code>Repositories</code>. O objetivo desse exercício é testar o contrato entre as APIs, sem utilizar integração com banco de dados. Os dados são armazenados em uma coleção em memória. Abaixo está o diagrama com os principais componentes.</p>
<figure><img src="images/2-person-data-service-component-diagram.png"
         alt="Componentes de person-data-service"/><figcaption>
            <p>Componentes de <code>person-data-service</code></p>
        </figcaption>
</figure>

<h3 id="serviço-de-dados-de-livros">Serviço de Dados de Livros</h3>
<p>O <code>book-data-service</code> possui duas APIs: uma que recebe o código do livro e retorna seus dados, e outra responsável por atualizar o estoque. O código está estruturado de forma similar ao <code>person-data-service</code>, ou seja, com <code>Controller</code>, <code>Service</code> e <code>Repository</code>, conforme demonstrado no diagrama abaixo.</p>
<figure><img src="images/3-book-data-service-component-diagram.png"
         alt="Componentes de book-data-service."/><figcaption>
            <p>Componentes de <code>book-data-service</code>.</p>
        </figcaption>
</figure>

<h3 id="obter-dados-dos-livros">Obter dados dos livros</h3>
<p>O comando <code>curl</code> abaixo demonstra como fazer uma requisição para obter os dados de um livro.</p>
<pre><code>curl --location --request GET 'http://localhost:8081/books/201'
</code></pre>
<p>O retorno será no formato <code>JSON</code> conforme demonstrado abaixo.</p>
<pre><code>{
  &quot;id&quot;: 202,
  &quot;name&quot;: &quot;Refactoring: Improving the Design of Existing Code&quot;,
  &quot;stock&quot;: 0,
  &quot;isbn&quot;: &quot;0201485672&quot;
} 
</code></pre>
<h3 id="atualizar-o-estoque-do-livro">Atualizar o estoque do livro</h3>
<p>A atualização do estoque de um livro é feita por meio de uma requisição <code>POST</code>, como exemplificado abaixo.</p>
<pre><code>curl --location 'http://localhost:8081/books/updateStock' \
--header 'Content-Type: application/json' \
--data '{&quot;id&quot;: 202,&quot;quantity&quot;: 1}'
</code></pre>
<p>A API irá retornar o status da operação com <code>SUCCESS</code> ou <code>FAILURE</code>, dependendo do resultado. No caso de sucesso:</p>
<pre><code>{
    &quot;status&quot;: &quot;SUCCESS&quot;,
    &quot;message&quot;:&quot;The stock of the book 202 was update to 2.&quot;
}
</code></pre>
<p>Se ocorrer algum problema, uma falha será retornada, como demonstrado no exemplo abaixo, onde a operação resulta em um estoque negativo.</p>
<pre><code>{
 &quot;status&quot;: &quot;FAILURE&quot;,
 &quot;message&quot;: &quot;Failed to update stock of book 202 because the new stock will be less than 0.&quot;
}
</code></pre>
<h3 id="serviço-de-venda-de-livros">Serviço de Venda de Livros</h3>
<p>O serviço principal é o <code>book-sales-service</code>. Este é o serviço responsável por realizar as operações de vendas, orquestrando a integração com outros microserviços.</p>
<p>Para efetuar uma venda, é necessário fornecer o código do livro e o código da pessoa. O serviço então consulta os dados da pessoa no <code>person-data-service</code> e os dados do livro no <code>book-data-service</code>. Ao final da operação, faz uma nova chamada ao <code>book-data-service</code> para atualizar o estoque. A operação pode ser realizada utilizando o comando <code>curl</code> abaixo.</p>
<pre><code>curl -X POST --location 'http://localhost:8080/book-sales' \
--header 'Content-Type: application/json' \
--data '{&quot;personId&quot;: 1001,&quot;bookId&quot;: 203}'
</code></pre>
<p>Se a venda for realizada com sucesso, uma mensagem será retornada para indicar a conclusão da operação, como exemplificado abaixo.</p>
<pre><code>{
  &quot;status&quot;: &quot;SUCCESS&quot;,
  &quot;message&quot;: &quot;The sale to person John with passport number FT8966563 was successful.&quot;
}
</code></pre>
<p>Caso aconteça alguma falha na venda, uma mensagem com mais detalhes é retornada. No exemplo abaixo, um exemplo de venda de um livro que não possui estoque.</p>
<pre><code>{
 &quot;status&quot;: &quot;OUT_OF_STOCK&quot;, 
 &quot;message&quot;: &quot;The current stock of book 201 is 0 and is not sufficient to make the sale.&quot;
}
</code></pre>
<p>Além do <code>Controller</code>, <code>Service</code> e <code>Repository</code>, esse serviço possui os componentes responsáveis por integrar com os provedores, são eles: <code>BookDataServiceWebClient</code>; e <code>PersonDataServiceWebClient</code>. O diagrama abaixo demonstra como os componentes estão organizados.
<figure><img src="images/4-book-sales-service-component-diagram.png"
         alt="Componentes de book-sales-service."/><figcaption>
            <p>Componentes de <code>book-sales-service</code>.</p>
        </figcaption>
</figure>
</p>
<h2 id="testes-de-contrato">Testes de Contrato</h2>
<p>O serviço <code>book-sales-service</code> depende do <code>book-data-service</code> e do <code>person-data-service</code> para realizar uma operação de venda, o que torna essencial garantir a comunicação entre eles.</p>
<p>Os Testes de Contrato são uma maneira eficiente de garantir a integração, evitando problemas decorrentes da quebra de contrato. <a href="https://pact.io/">Pact</a> é uma ferramenta que possui as características necessárias para trabalhar com testes de contrato, oferecendo funcionalidades que permitem que os testes sejam orientados pelos consumidores, ou seja, os consumidores definem qual contrato deve ser seguido.</p>
<h3 id="pact">Pact</h3>
<p>Pact permite testar a integração entre provedores e consumidores de dados. Possui uma abordagem simples e fácil de ser colocada em prática, com três pontos principais: <code>Broker</code>, <code>Provider</code> e <code>Consumer</code>.</p>
<p>O <code>broker</code> é responsável por centralizar os contratos, sendo nele que os <code>Consumers</code> publicam seus contratos. Os <code>Providers</code> também utilizam o <code>broker</code>, porém com o objetivo de verificar se a API está de acordo com o contrato definido pelos Consumers.</p>
<p>O diagrama abaixo, fornecido pela própria documentação do Pact, demonstra em mais detalhes os passos utilizados.</p>
<figure><img src="images/5-pact-diagram.png"
         alt="Fonte da imagem: https://docs.pact.io/"/><figcaption>
            <p>Fonte da imagem: <a href="https://docs.pact.io/">https://docs.pact.io/</a></p>
        </figcaption>
</figure>

<h3 id="inclusão-do-pact-para-testar-os-contratos">Inclusão do Pact para testar os contratos</h3>
<p>O microsserviço responsável por consumir outras APIs é encarregado de criar e publicar o contrato. Neste caso, o <code>book-sales-service</code> é o <code>Consumer</code>. Os microserviços <code>book-data-api</code> e <code>person-data-api</code> são responsáveis por fornecer os dados, sendo eles os <code>Providers</code>.</p>
<h4 id="consumers">Consumers</h4>
<p>O primeiro passo é configurar o serviço para utilizar o <code>pact</code>. Neste exemplo, está sendo utilizado o <code>Gradle</code>, sendo necessário incluir o <code>plugin</code> e as dependências no arquivo <code>build.gradle</code>, conforme demonstrado abaixo.</p>
<pre><code>plugins {
 [...]
 id 'au.com.dius.pact' version &quot;4.3.15&quot;
}
</code></pre>
<pre><code>dependencies {
 [...]
 testImplementation 'au.com.dius.pact.consumer:junit5:4.3.15'
}
</code></pre>
<p>É necessário incluir também a <code>url</code> do <code>broker</code> conforme demonstrado abaixo.</p>
<pre><code>pact {
 publish {
   pactBrokerUrl = &quot;http://localhost:9292&quot;
 }
}
</code></pre>
<h4 id="contrato-com-person-data-service">Contrato com <code>person-data-service</code></h4>
<p>Para criar o contrato com <code>person-data-service</code> é necessário uma nova classe que estende <code>PactConsumerTestExt</code>.</p>
<pre><code class="language-java">@ExtendWith(PactConsumerTestExt.class)
public class BookSalesConsumerForPersonDataContractTest
</code></pre>
<p>Deve-se criar um método com os detalhes do contrato, onde são estabelecidos os requisitos por parte do consumidor. Como pode ser visto abaixo, espera-se que no corpo da resposta sejam retornados o código da pessoa, nome e número do passaporte.</p>
<pre><code class="language-java">@Pact(consumer = CONSUMER_BOOK_SALES_SERVICE_GET_PERSONS, provider = PROVIDER_PERSON_DATA_SERVICE)
public V4Pact whenRequestPersonById_thenReturnsPerson(PactDslWithProvider builder) {
    PactDslJsonBody bodyResponse = new PactDslJsonBody()
            .integerType(&quot;id&quot;, A_PERSON_ID)
            .stringType(&quot;name&quot;, A_PERSON_NAME)
            .stringType(&quot;passportNumber&quot;, A_PERSON_PASSPORT_NUMBER);

    return builder
            .given(&quot;it has a person and status code is 200&quot;)
                .uponReceiving(&quot;a request to retrieve a person by id&quot;)
                .path(&quot;/persons/&quot; +A_PERSON_ID)
                .method(&quot;GET&quot;)
            .willRespondWith()
                .headers(Collections.singletonMap(&quot;Content-Type&quot;, &quot;application/json&quot;))
                .status(OK.value())
                .body(bodyResponse)
            .toPact(V4Pact.class);
}
</code></pre>
<p>É necessário também um segundo método com objetivo de fazer a interação com o teste. Nele é utilizado <code>MockServer</code> em conjunto com o <code>WebClient</code> conforme demonstrado abaixo.</p>
<pre><code class="language-java">@PactTestFor(providerName = PROVIDER_PERSON_DATA_SERVICE, 
        pactMethod = &quot;whenRequestPersonById_thenReturnsPerson&quot;, 
        providerType = SYNCH)
@Test
public void whenRequestPersonById_thenReturnsPerson(MockServer mockServer) {
    // given
    WebClient webClient = WebClient.builder()
            .baseUrl(mockServer.getUrl())
            .build();

    // when
    PersonDataServiceWebClient personDataServiceWebClient = 
            new PersonDataServiceWebClient(webClient, &quot;/persons/{personId}&quot;);
    PersonDataResponse personDataResponse = personDataServiceWebClient.retrievePerson(A_PERSON_ID);

    // then
    assertThat(personDataResponse.getId()).isInstanceOf(Long.class).isEqualTo(A_PERSON_ID);
    assertThat(personDataResponse.getName()).isInstanceOf(String.class).isEqualTo(A_PERSON_NAME);
    assertThat(personDataResponse.getPassportNumber()).isInstanceOf(String.class).isEqualTo(A_PERSON_PASSPORT_NUMBER);
}
</code></pre>
<h4 id="contrato-com-book-data-service">Contrato com <code>book-data-service</code></h4>
<p>No caso de <code>book-data-service</code> são duas dependências, uma para obter os dados do livro e outro para solicitar a atualização do estoque.</p>
<pre><code class="language-java">@Pact(consumer = CONSUMER_BOOK_SALES_SERVICE_GET_BOOKS, provider = PROVIDER_BOOK_DATA_SERVICE)
public V4Pact whenRequestBookById_thenReturnsBook(PactDslWithProvider builder) {
    PactDslJsonBody bodyResponse = new PactDslJsonBody()
        .integerType(&quot;id&quot;, A_BOOK_ID)
        .integerType(&quot;stock&quot;, A_BOOK_STOCK);

    return builder
        .given(&quot;it has a book and status code is 200&quot;)
            .uponReceiving(&quot;a request to retrieve a book by id&quot;)
            .path(&quot;/books/&quot; + A_BOOK_ID)
            .method(&quot;GET&quot;)
        .willRespondWith()
            .headers(Collections.singletonMap(&quot;Content-Type&quot;, &quot;application/json&quot;))
            .status(OK.value())
            .body(bodyResponse)
        .toPact(V4Pact.class);
}

@Pact(consumer = CONSUMER_BOOK_SALES_SERVICE_UPDATE_STOCK, provider = PROVIDER_BOOK_DATA_SERVICE)
public V4Pact whenUpdateBookStock_thenReturnsStatus(PactDslWithProvider builder) {
    PactDslJsonBody responseBody = new PactDslJsonBody()
        .stringType(&quot;status&quot;, &quot;SUCCESS&quot;)
        .stringType(&quot;message&quot;, &quot;The stock of the book &quot; + A_BOOK_ID + &quot; was update to 16&quot;);

    PactDslJsonBody requestBody = new PactDslJsonBody()
        .integerType(&quot;id&quot;, A_BOOK_ID)
        .integerType(&quot;quantity&quot;, A_BOOK_QUANTITY)
        .asBody();

    return builder
        .given(&quot;it has a book and stock can be updated&quot;)
            .uponReceiving(&quot;a request to update the stock of book&quot;)
            .method(HttpMethod.POST.name())
            .path(PATH_UPDATE_STOCK)
            .headers(Collections.singletonMap(&quot;Content-Type&quot;, &quot;application/json&quot;))
            .body(requestBody)
        .willRespondWith()
            .headers(Map.of(&quot;Content-type&quot;, &quot;application/json&quot;))
            .status(OK.value())
            .body(responseBody)
        .toPact(V4Pact.class);
}
</code></pre>
<h3 id="providers">Providers</h3>
<p>Com os contratos definidos pelos <code>Consumers</code>, o próximo passo é preparar a verificação pelos provedores. Os providers são <code>book-data-service</code> e <code>person-data-service</code>, sendo necessário criar um teste específico para cada um deles. Nesse caso, a inclusão do <code>Pact</code> depende da adição da dependência e das configurações no arquivo <code>build.gradle</code>, conforme demonstrado abaixo.</p>
<pre><code>dependencies {
 [...]
 testImplementation 'au.com.dius.pact.provider:junit5spring:4.5.6'
}
</code></pre>
<p>Algumas variáveis precisam ser definidas para a execução dos testes. São elas: a <code>url</code>, a versão e se os resultados devem ser publicados com a execução dos testes.</p>
<pre><code>tasks.named('test') {
 useJUnitPlatform()

 systemProperties[&quot;pactbroker.url&quot;] = &quot;http://localhost:9292&quot;
 systemProperties[&quot;pact.provider.version&quot;] = version
 systemProperties[&quot;pact.verifier.publishResults&quot;] = &quot;true&quot;
}
</code></pre>
<h3 id="verificação-do-contrato-por-person-data-service">Verificação do contrato por <code>person-data-service</code></h3>
<p>Para que não seja necessário iniciar toda a aplicação, é utilizado <code>@WebMvcTest</code>. Um <code>mock</code> da classe de serviço é adicionado para que o contexto do teste seja específica para o <code>Controller</code>.</p>
<pre><code class="language-java">@WebMvcTest
@Provider(&quot;person-data-service&quot;)
@PactBroker
public class PersonDataProviderForBookSalesContractTest {
    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private PersonService personService;

    @BeforeEach
    public void setUp(PactVerificationContext context){
        context.setTarget(new MockMvcTestTarget(mockMvc));
    }
    
    //[...]
}
</code></pre>
<p>O <code>mock</code> deve ser incluído em um método anotado com <code>@State</code>, que é o ponto do código onde se conecta com o <code>Consumer</code>. No <code>@State</code>, é importante que a string definida seja a mesma definida quando se está criando o contrato no <code>consumer</code>. No caso de pessoa, ela é atribuída no builder de <code>V4Pact</code> em <code>given(&quot;it has a person and status code is 200&quot;)</code>.</p>
<pre><code class="language-java">@State(&quot;it has a person and status code is 200&quot;)
public void itHasPersonWithIdAndStatusIs200() {
    when(personService.getPersonById(A_PERSON_ID))
            .thenReturn(Person.builder()
                    .id(A_PERSON_ID)
                    .name(A_PERSON_NAME)
                    .passportNumber(A_PERSON_PASSPORT_NUMBER)
                    .build());
}
</code></pre>
<p>Por fim, é necessário adicionar o código responsável por realizar a verificação do contrato.</p>
<pre><code class="language-java">@TestTemplate
@ExtendWith(PactVerificationSpringProvider.class)
void pactVerificationTestTemplate(PactVerificationContext context) {
    context.verifyInteraction();
}
</code></pre>
<h3 id="verificação-do-contrato-por-book-data-service">Verificação do contrato por <code>book-data-service</code></h3>
<p>O mesmo procedimento deve ser feito para o <code>book-data-service</code>, sendo a única diferença que neste caso há dois contratos: um para retornar os dados do livro e outro para atualizar o estoque. Portanto, são necessários dois <code>@State</code>, como demonstrado abaixo.</p>
<pre><code class="language-java">@State(&quot;it has a book and status code is 200&quot;)
public void itHasBookWithIdAndStatusIs200() {
    when(bookService.getBookById(A_BOOK_ID))
            .thenReturn(Book.builder()
                    .id(A_BOOK_ID)
                    .stock(A_BOOK_STOCK)
                    .build());
}

@State(&quot;it has a book and stock can be updated&quot;)
public void aRequestToUpdateTheStockOfBook() {
    when(bookService.updateStock(A_BOOK_ID, A_BOOK_QUANTITY_UPDATE_STOCK))
            .thenReturn(UpdateStockResult.builder()
                    .message(&quot;The stock of the book &quot; + A_BOOK_ID + &quot; was update to 16&quot;)
                    .status(SUCCESS)
                    .build());
}
</code></pre>
<h2 id="publicação-e-verificação-do-contrato">Publicação e Verificação do contrato</h2>
<p>Com os testes criados, o próximo passo é publicar o contrato no Pact Broker, permitindo assim que os providers realizem a verificação. É necessário ter uma instância do broker, para isso utilizamos um contêiner. Abaixo está o código responsável pelo contêiner, que faz parte do <code>docker-compose</code> utilizado para os serviços.</p>
<pre><code>services:
  pactbroker:
    image: pactfoundation/pact-broker:2.104.0.0
    environment:
      PACT_BROKER_DATABASE_ADAPTER: sqlite
      PACT_BROKER_DATABASE_NAME: pactbroker
    ports:
      - &quot;9292:9292&quot;
[...]   
</code></pre>
<p>Para iniciar somente o <code>pact broker</code>, basta executar o comando abaixo. O <code>broker</code> estará disponível em <code>http://localhost:9292/</code>.</p>
<pre><code>docker-compose up pactbroker -d
</code></pre>
<p>Uma página semelhante a demonstrada na figura abaixo será exibida.</p>
<figure><img src="images/6-initial-page-broker.png"
         alt="Página inicial do pact broker."/><figcaption>
            <p>Página inicial do pact broker.</p>
        </figcaption>
</figure>

<h3 id="publicação-do-contrato-pelo-consumer">Publicação do contrato pelo consumer</h3>
<p>Com o <code>broker</code> funcionando, o próximo passo é realizar a publicação do contrato pelo consumidor, o <code>book-sales-service</code>. Para isso, é necessário estar no diretório do projeto e fazer o <code>build</code>, conforme demonstrado abaixo.</p>
<pre><code>./gradlew clean build
</code></pre>
<p>Isso vai gerar alguns arquivos <code>json</code> em <code>buid\pacts</code>. Para cada contrato é gerado um arquivo diferente, como demonstrado abaixo.</p>
<figure><img src="images/7-folder-with-json-of-pact.png"
         alt="Arquivos json com os contratos."/><figcaption>
            <p>Arquivos <code>json</code> com os contratos.</p>
        </figcaption>
</figure>

<p>Basta agora publicar os arquivos para o <code>broker</code> conforme demonstrado abaixo.</p>
<pre><code>./gradlew pactPublish
</code></pre>
<p>Ao acessar o <code>broker</code>, será possível visualizar os três contratos publicados.
<figure><img src="images/8-publish-contract-to-broker.png"
         alt="Contratos publicados pelo consumidor."/><figcaption>
            <p>Contratos publicados pelo consumidor.</p>
        </figcaption>
</figure>
</p>
<h3 id="verificação-do-contrato-pelos-providers">Verificação do contrato pelos providers</h3>
<p>Com os contratos publicados, o próximo passo é fazer a verificação pelos provedores. Nesta etapa, é possível impedir a liberação de qualquer alteração que quebre o contrato.</p>
<p>São dois serviços que precisam verificar os contratos. Vamos começar com o <code>person-data-service</code>. Dentro do projeto, basta realizar o <code>clean</code> e o <code>build</code>, pois assim os testes serão executados.</p>
<pre><code>./gradlew clean build
</code></pre>
<p>Se tudo ocorrer conforme esperado, é então exibido na coluna <code>Last verified</code> a verificação realizada, conforme demonstrado na imagem abaixo.</p>
<figure><img src="images/9-broker-verify-person-data-service.png"
         alt="Verificação do contrato por person-data-service."/><figcaption>
            <p>Verificação do contrato por <code>person-data-service</code>.</p>
        </figcaption>
</figure>

<p>O mesmo procedimento deve ser realizado para <code>book-data-service</code>, dentro do projeto fazer o <code>clean</code> e <code>build</code> do projeto.</p>
<pre><code>./gradlew clean build
</code></pre>
<p>Se os testes passarem, o <code>broker</code> é então atualizado com as verificações realizadas.</p>
<figure><img src="images/10-broker-verify-book-data-service.png"
         alt="Verificação do contrato por book-data-service."/><figcaption>
            <p>Verificação do contrato por <code>book-data-service</code>.</p>
        </figcaption>
</figure>

<h2 id="simulando-a-quebra-de-contratos">Simulando a quebra de contratos</h2>
<p>Um grande benefício do uso de testes de contrato é a capacidade de garantir que os provedores possam fazer alterações sem afetar negativamente os consumidores. Para testar esse cenário, vamos simular algumas alterações e observar como o <code>Pact</code> responde a esse tipo de situação.</p>
<h3 id="simulação-1-provider-remove-campo-da-api">Simulação 1: Provider remove campo da API</h3>
<p>No primeiro cenário, o <code>person-data-service</code> realiza uma alteração removendo o campo número do passaporte, essencial para o serviço <code>book-sales-service</code>. Com a remoção do campo, a resposta do serviço fica da seguinte forma.</p>
<pre><code>{
    &quot;id&quot;:1002,
    &quot;name&quot;:&quot;Maria&quot;,
    &quot;country&quot;:&quot;Brazil&quot;
}
</code></pre>
<p>Essa simulação de alteração está disponível em um <code>branch</code>, para acessar basta fazer o <code>checkout</code>.</p>
<pre><code>git checkout simulation-1-person-data-remove-passport-number
</code></pre>
<p>Com a alteração realizada, o próximo passo é executar os testes de contrato do <code>person-data-service</code>. Para isso, o comando abaixo pode ser utilizado.</p>
<pre><code>./gradlew clean build  
</code></pre>
<p>O teste falhará e a razão pode ser visualizada no relatório gerado.
<figure><img src="images/11-contract-change-passport-report-fail.png"
         alt="Relatório com detalhes sobre falha."/><figcaption>
            <p>Relatório com detalhes sobre falha.</p>
        </figcaption>
</figure>
</p>
<p>O <code>broker</code> também sinalizará uma quebra no contrato na matriz de verificação.
<figure><img src="images/12-contract-change-passport-matrix.png"
         alt="Matriz de verificação do contrato."/><figcaption>
            <p>Matriz de verificação do contrato.</p>
        </figcaption>
</figure>
</p>
<p>Mais detalhes está disponível ao clicar no item da matriz com a falha.
<figure><img src="images/13-contract-change-passport-broker-detail.png"
         alt="Detalhes sobre a falha na verificação."/><figcaption>
            <p>Detalhes sobre a falha na verificação.</p>
        </figcaption>
</figure>
</p>
<h3 id="simulação-2-provider-renomeia-campo-da-api">Simulação 2: Provider renomeia campo da API</h3>
<p>Na segunda simulação, o serviço <code>book-data-service</code> altera o nome do campo <code>stock</code> para <code>currentStock</code>. Com essa modificação, abaixo está o novo corpo de resposta da API.</p>
<pre><code class="language-json">{
    &quot;id&quot;:201,
    &quot;name&quot;:&quot;Domain-Driven Design: Tackling Complexity in the Heart of Software&quot;,
    &quot;currentStock&quot;:0,
    &quot;isbn&quot;:&quot;9780321125217&quot;
}
</code></pre>
<p>Essa simulação de alteração também está disponível em um branch.</p>
<pre><code>git checkout simulation-2-book-data-change-stock-field-name
</code></pre>
<p>Para ver o teste quebrar, basta fazer o build do projeto.</p>
<pre><code>./gradlew clean build  
</code></pre>
<p>Um relatório com a falha também será gerado, apontando mais detalhes sobre a quebra de contrato.
<figure><img src="images/14-contract-change-stock-name-report-fail.png"
         alt="Relatório com detalhes sobre falha."/><figcaption>
            <p>Relatório com detalhes sobre falha.</p>
        </figcaption>
</figure>
</p>
<p>A matriz de verificação aponta mais detalhes sobre o histórico de verificação.
<figure><img src="images/15-contract-change-stock-name-matrix.png"
         alt="Matriz de verificação do contrato."/><figcaption>
            <p>Matriz de verificação do contrato.</p>
        </figcaption>
</figure>
</p>
<p>Para ver mais detalhes sobre a falha, basta clicar no item da matriz.
<figure><img src="images/16-contract-change-stock-name-broker-detail.png"
         alt="Detalhes sobre a falha na verificação."/><figcaption>
            <p>Detalhes sobre a falha na verificação.</p>
        </figcaption>
</figure>
</p>
<h3 id="simulação-3-provider-renomeia-campo-em-api-post">Simulação 3: Provider renomeia campo em API Post</h3>
<p>Na terceira simulação, ocorre a mudança do nome do campo de <code>quantity</code> para <code>quantityToUpdate</code> na requisição de atualização do estoque para o microserviço <code>book-data-service</code>. Abaixo está o novo corpo da requisição com essa alteração.</p>
<pre><code>{
    &quot;id&quot;: 202,
    &quot;quantityToUpdate&quot;: 1
}
</code></pre>
<p>Essa simulação de alteração está disponível em um <code>branch</code>.</p>
<pre><code>git checkout simulation-3-book-data-rename-field-name-post-request
</code></pre>
<p>Para ver o teste quebrar, basta fazer o build do projeto.</p>
<pre><code>./gradlew clean build  
</code></pre>
<p>O relatório com a falha será gerado, apontando mais detalhes sobre a quebra de contrato. Nesse caso, é esperado sucesso na operação, porém é retornado código 400 sinalizando que o campo <code>quantityToUpdate</code> não foi enviado no corpo da requisição.</p>
<figure><img src="images/17-contract-change-post-stock-quantity-report-fail.png"
         alt="Relatório com detalhes sobre falha."/><figcaption>
            <p>Relatório com detalhes sobre falha.</p>
        </figcaption>
</figure>

<p>A matriz de verificação aponta mais detalhes sobre o histórico de verificação.
<figure><img src="images/18-contract-change-post-stock-quantity-matrix.png"
         alt="Matriz de verificação do contrato."/><figcaption>
            <p>Matriz de verificação do contrato.</p>
        </figcaption>
</figure>
</p>
<p>Para ver mais detalhes sobre a falha, basta clicar no item da matriz.
<figure><img src="images/19-contract-change-post-stock-quantity-broker-detail.png"
         alt="Detalhes sobre a falha na verificação."/><figcaption>
            <p>Detalhes sobre a falha na verificação.</p>
        </figcaption>
</figure>
</p>
<h2 id="conclusão">Conclusão</h2>
<p>A utilização de testes de contrato em ambientes com múltiplos microserviços simplifica a prevenção de quebras de contrato que possam afetar a integração entre as APIs. Embora demande um esforço adicional para preparar o ambiente e criar os contratos, uma vez feito isso, os serviços se tornam mais seguros e menos vulneráveis a falhas. Abaixo estão alguns dos benefícios ao utilizar testes de contrato:</p>
<ul>
<li>Os contratos tornam os serviços menos vulneráveis a falhas na integração, já que alterações que possam impactá-los passam a quebrar o contrato.</li>
<li>Provedores que têm vários consumidores deixam explícito cada contrato. Assim, é mais fácil saber quais serviços dependem de algo específico e planejar alterações de forma mais segura.</li>
<li>Refatorações tornam-se mais seguras, pois sabe-se exatamente o que cada consumidor utiliza na API. Um exemplo são campos incluídos sem justificativa e ninguém sabe ao certo por que estão ali.</li>
<li>É uma maneira de padronizar os contratos entre microserviços em um cenário com várias equipes.</li>
<li>Documentações são muito importantes, mas mais suscetíveis a falhas. Testes de contrato são uma forma automatizada que pode ser configurada para quebrar o <code>build</code> da aplicação em caso de falha de contrato.</li>
<li>É uma abordagem que se assemelha ao <code>TDD (Test-Driven Development)</code>, onde os testes criados no provider são guiados pelos testes criados nos consumidores.</li>
</ul>
<h2 id="referências">Referências</h2>
<ul>
<li>Diagramas criados utilando o C4 Model. Mais detalhes em <a href="https://c4model.com/">https://c4model.com/</a>.</li>
<li>Pact Documentation. <a href="https://docs.pact.io/">https://docs.pact.io/</a>.</li>
<li>Contract Test. Martin Fowler. Disponível em <a href="https://martinfowler.com/bliki/ContractTest.html">https://martinfowler.com/bliki/ContractTest.html</a>.</li>
<li>Consumer-Driven Contracts: A Service Evolution Pattern. Ian Robinson. <a href="https://martinfowler.com/articles/consumerDrivenContracts.html">https://martinfowler.com/articles/consumerDrivenContracts.html</a>.</li>
<li>Testing the Web Layer. <a href="https://spring.io/guides/gs/testing-web">https://spring.io/guides/gs/testing-web</a>.</li>
<li>Pact Spring/JUnit5 Support. <a href="https://docs.pact.io/implementation_guides/jvm/provider/junit5spring">https://docs.pact.io/implementation_guides/jvm/provider/junit5spring</a>.</li>
</ul>

  </main>
  <div id="disqus-container">
  
</div>

  


          
            <footer role="contentinfo">
  <div
  style="display: none;"
  >
    <label for="themer">
       <input type="checkbox" id="themer" class="vh">
      
      <span aria-hidden="true"></span>
    </label>
  </div>
  
</footer>

          
        </div>
      </div>
    </div>
    

<script src="/js/dom-scripts.js"></script>  

<script src="/js/prism.js"></script>



<script src="/js/search.7aef046a0cc8b0c532f1d20087b920459bc868c936bb48a6ae221eceefca2d07.js"></script>

<link rel="stylesheet" href="/css/search.fe0cd54a21628574bff49d721c827d1bb165ab56b0f22dd55ae78addbe61c309.css"></link>




    
    
  

  </body>
</html>
